<!DOCTYPE html>
<html>
<head>
<title>MineChan</title>
</head>
<body style="background:black;color:lime;font-family:monospace">

<h1>MineChan</h1>

<input id="title" placeholder="Title"><br><br>
<textarea id="content" placeholder="Message"></textarea><br>
<button onclick="post()">Post</button>

<div id="threads"></div>

<script>

const USER="YOUR_USERNAME";
const REPO="YOUR_REPO";

async function load(){

let res=await fetch(`https://raw.githubusercontent.com/${USER}/${REPO}/main/threads.json`);

let data=await res.json();

let div=document.getElementById("threads");

div.innerHTML="";

data.reverse().forEach(t=>{

div.innerHTML+=`
<hr>
<b>${t.title}</b><br>
${t.content}<br>
${t.time}
`;

});

}

async function post(){

let title=document.getElementById("title").value;
let content=document.getElementById("content").value;

let res=await fetch(`https://raw.githubusercontent.com/${USER}/${REPO}/main/threads.json`);
let data=await res.json();

data.push({
title:title,
content:content,
time:new Date().toLocaleString()
});

await fetch(`https://api.github.com/repos/${USER}/${REPO}/actions/workflows/save-thread.yml/dispatches`,{
method:"POST",
headers:{
"Accept":"application/vnd.github+json"
},
body:JSON.stringify({
ref:"main",
inputs:{
data:JSON.stringify(data)
}
})
});

alert("Posted!");

}

load();

</script>

</body>
</html>
